<!DOCTYPE html>
<html>
   <head>
      <title>biobb_mem/fatslim/fatslim_membranes.py - flake8 annotated source</title>
      <meta http-equiv="Content-Type" value="text/html; charset=UTF-8">
      <link rel="stylesheet" href="styles.css">
   </head>
   <body>
      <div id="masthead" class="sev-2"></div>
      <div id="page">
         <h1>
            <a href="biobb_mem.fatslim.fatslim_membranes.report.html">
               <img src="back.svg" alt="&#x2B05;">
               biobb_mem/fatslim/fatslim_membranes.py source
            </a>
         </h1>

         <div id="doc">
            <div id="l1"
               class="code sev- "><tt><i>1</i> <span class="ch">#!/usr/bin/env python3</span></tt>
            </div>
            <div id="l2"
               class="code sev- "><tt><i>2</i> &nbsp;</tt>
            </div>
            <div id="l3"
               class="code sev- "><tt><i>3</i> <span class="sd">&quot;&quot;&quot;Module containing the FATSLiM Membranes class and the command line interface.&quot;&quot;&quot;</span></tt>
            </div>
            <div id="l4"
               class="code sev- "><tt><i>4</i> <span class="kn">import</span><span class="w"> </span><span class="nn">argparse</span></tt>
            </div>
            <div id="l5"
               class="code sev- "><tt><i>5</i> <span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">PurePath</span></tt>
            </div>
            <div id="l6"
               class="code sev- "><tt><i>6</i> <span class="kn">from</span><span class="w"> </span><span class="nn">biobb_common.generic.biobb_object</span><span class="w"> </span><span class="kn">import</span> <span class="n">BiobbObject</span></tt>
            </div>
            <div id="l7"
               class="code sev- "><tt><i>7</i> <span class="kn">from</span><span class="w"> </span><span class="nn">biobb_common.configuration</span><span class="w"> </span><span class="kn">import</span> <span class="n">settings</span></tt>
            </div>
            <div id="l8"
               class="code sev- "><tt><i>8</i> <span class="kn">from</span><span class="w"> </span><span class="nn">biobb_common.tools.file_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">launchlogger</span></tt>
            </div>
            <div id="l9"
               class="code sev- "><tt><i>9</i> <span class="kn">from</span><span class="w"> </span><span class="nn">biobb_common.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">file_utils</span> <span class="k">as</span> <span class="n">fu</span></tt>
            </div>
            <div id="l10"
               class="code sev- "><tt><i>10</i> <span class="kn">import</span><span class="w"> </span><span class="nn">MDAnalysis</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mda</span></tt>
            </div>
            <div id="l11"
               class="code sev- "><tt><i>11</i> <span class="kn">from</span><span class="w"> </span><span class="nn">MDAnalysis.transformations.boxdimensions</span><span class="w"> </span><span class="kn">import</span> <span class="n">set_dimensions</span></tt>
            </div>
            <div id="l12"
               class="code sev- "><tt><i>12</i> <span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span></tt>
            </div>
            <div id="l13"
               class="code sev- "><tt><i>13</i> <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span></tt>
            </div>
            <div id="l14"
               class="code sev- "><tt><i>14</i> &nbsp;</tt>
            </div>
            <div id="l15"
               class="code sev-2  le">
               <ul class="violations">
               
                  <li>
                     <span class="count sev-2">
                        E302
                     </span>
                     Expected 2 blank lines, found 1</li>
               
               </ul><tt><i>15</i> <span class="k">class</span><span class="w"> </span><span class="nc">FatslimMembranes</span><span class="p">(</span><span class="n">BiobbObject</span><span class="p">):</span></tt>
            </div>
            <div id="l16"
               class="code sev- "><tt><i>16</i> <span class="w">    </span><span class="sd">&quot;&quot;&quot;</span></tt>
            </div>
            <div id="l17"
               class="code sev- "><tt><i>17</i> <span class="sd">    | biobb_mem FatslimMembranes</span></tt>
            </div>
            <div id="l18"
               class="code sev- "><tt><i>18</i> <span class="sd">    | Wrapper of the `FATSLiM membranes &lt;https://pythonhosted.org/fatslim/documentation/leaflets.html&gt;`_ module for leaflet and membrane identification.</span></tt>
            </div>
            <div id="l19"
               class="code sev- "><tt><i>19</i> <span class="sd">    | FATSLiM is designed to provide efficient and robust analysis of physical parameters from MD trajectories, with a focus on processing large trajectory files quickly.</span></tt>
            </div>
            <div id="l20"
               class="code sev- "><tt><i>20</i> &nbsp;</tt>
            </div>
            <div id="l21"
               class="code sev- "><tt><i>21</i> <span class="sd">    Args:</span></tt>
            </div>
            <div id="l22"
               class="code sev- "><tt><i>22</i> <span class="sd">        input_top_path (str): Path to the input topology file. File type: input. `Sample file &lt;https://github.com/bioexcel/biobb_mem/raw/main/biobb_mem/test/data/A01JD/A01JD.pdb&gt;`_. Accepted formats: tpr (edam:format_2333), gro (edam:format_2033), g96 (edam:format_2033), pdb (edam:format_1476), brk (edam:format_2033), ent (edam:format_1476).</span></tt>
            </div>
            <div id="l23"
               class="code sev- "><tt><i>23</i> <span class="sd">        input_traj_path (str) (Optional): Path to the GROMACS trajectory file. File type: input. `Sample file &lt;https://github.com/bioexcel/biobb_mem/raw/main/biobb_mem/test/data/A01JD/A01JD.xtc&gt;`_. Accepted formats: xtc (edam:format_3875), trr (edam:format_3910), cpt (edam:format_2333), gro (edam:format_2033), g96 (edam:format_2033), pdb (edam:format_1476), tng (edam:format_3876).</span></tt>
            </div>
            <div id="l24"
               class="code sev- "><tt><i>24</i> <span class="sd">        output_ndx_path (str): Path to the output index NDX file. File type: output. `Sample file &lt;https://github.com/bioexcel/biobb_mem/raw/main/biobb_mem/test/data/A01JD/A01JD.ndx&gt;`_. Accepted formats: ndx (edam:format_2033).</span></tt>
            </div>
            <div id="l25"
               class="code sev- "><tt><i>25</i> <span class="sd">        properties (dic - Python dictionary object containing the tool parameters, not input/output files):</span></tt>
            </div>
            <div id="l26"
               class="code sev- "><tt><i>26</i> <span class="sd">            * **selection** (*str*) - (&quot;resname DPPC and element P&quot;) Molecules used in the identification using MDAnalysis `selection language &lt;https://docs.mdanalysis.org/stable/documentation_pages/selections.html&gt;`_.</span></tt>
            </div>
            <div id="l27"
               class="code sev- "><tt><i>27</i> <span class="sd">            * **cutoff** (*float*) - (2) Cutoff distance (in nm) to be used when leaflet identification is performed.</span></tt>
            </div>
            <div id="l28"
               class="code sev- "><tt><i>28</i> <span class="sd">            * **begin_frame** (*int*) - (-1) First frame index to be used for analysis.</span></tt>
            </div>
            <div id="l29"
               class="code sev- "><tt><i>29</i> <span class="sd">            * **end_frame** (*int*) - (-1) Last frame index to be used for analysis.</span></tt>
            </div>
            <div id="l30"
               class="code sev- "><tt><i>30</i> <span class="sd">            * **ignore_no_box** (*bool*) - (False) Ignore the absence of box information in the topology. If the topology does not contain box information, the box will be set to the minimum and maximum positions of the atoms.</span></tt>
            </div>
            <div id="l31"
               class="code sev- "><tt><i>31</i> <span class="sd">            * **return_hydrogen** (*bool*) - (False) Include hydrogen atoms in the output index file.</span></tt>
            </div>
            <div id="l32"
               class="code sev- "><tt><i>32</i> <span class="sd">            * **binary_path** (*str*) - (&quot;fatslim&quot;) Path to the fatslim executable binary.</span></tt>
            </div>
            <div id="l33"
               class="code sev- "><tt><i>33</i> <span class="sd">            * **remove_tmp** (*bool*) - (True) [WF property] Remove temporal files.</span></tt>
            </div>
            <div id="l34"
               class="code sev- "><tt><i>34</i> <span class="sd">            * **restart** (*bool*) - (False) [WF property] Do not execute if output files exist.</span></tt>
            </div>
            <div id="l35"
               class="code sev- "><tt><i>35</i> <span class="sd">            * **sandbox_path** (*str*) - (&quot;./&quot;) [WF property] Parent path to the sandbox directory.</span></tt>
            </div>
            <div id="l36"
               class="code sev- "><tt><i>36</i> &nbsp;</tt>
            </div>
            <div id="l37"
               class="code sev- "><tt><i>37</i> <span class="sd">    Examples:</span></tt>
            </div>
            <div id="l38"
               class="code sev- "><tt><i>38</i> <span class="sd">        This is a use example of how to use the building block from Python::</span></tt>
            </div>
            <div id="l39"
               class="code sev- "><tt><i>39</i> &nbsp;</tt>
            </div>
            <div id="l40"
               class="code sev- "><tt><i>40</i> <span class="sd">            from biobb_mem.fatslim.fatslim_membranes import fatslim_membranes</span></tt>
            </div>
            <div id="l41"
               class="code sev- "><tt><i>41</i> <span class="sd">            prop = {</span></tt>
            </div>
            <div id="l42"
               class="code sev- "><tt><i>42</i> <span class="sd">                &#39;selection&#39;: &#39;(resname DPPC and name P8)&#39;,</span></tt>
            </div>
            <div id="l43"
               class="code sev- "><tt><i>43</i> <span class="sd">                &#39;cutoff&#39;: 2.2</span></tt>
            </div>
            <div id="l44"
               class="code sev- "><tt><i>44</i> <span class="sd">            }</span></tt>
            </div>
            <div id="l45"
               class="code sev- "><tt><i>45</i> <span class="sd">            fatslim_membranes(input_top_path=&#39;/path/to/myTopology.tpr&#39;,</span></tt>
            </div>
            <div id="l46"
               class="code sev- "><tt><i>46</i> <span class="sd">                              input_traj_path=&#39;/path/to/myTrajectory.xtc&#39;,</span></tt>
            </div>
            <div id="l47"
               class="code sev- "><tt><i>47</i> <span class="sd">                              output_ndx_path=&#39;/path/to/newIndex.ndx&#39;,</span></tt>
            </div>
            <div id="l48"
               class="code sev- "><tt><i>48</i> <span class="sd">                              properties=prop)</span></tt>
            </div>
            <div id="l49"
               class="code sev- "><tt><i>49</i> &nbsp;</tt>
            </div>
            <div id="l50"
               class="code sev- "><tt><i>50</i> <span class="sd">    Info:</span></tt>
            </div>
            <div id="l51"
               class="code sev- "><tt><i>51</i> <span class="sd">        * wrapped_software:</span></tt>
            </div>
            <div id="l52"
               class="code sev- "><tt><i>52</i> <span class="sd">            * name: FATSLiM</span></tt>
            </div>
            <div id="l53"
               class="code sev- "><tt><i>53</i> <span class="sd">            * version: 0.2.2</span></tt>
            </div>
            <div id="l54"
               class="code sev- "><tt><i>54</i> <span class="sd">            * license: GNU</span></tt>
            </div>
            <div id="l55"
               class="code sev- "><tt><i>55</i> <span class="sd">        * ontology:</span></tt>
            </div>
            <div id="l56"
               class="code sev- "><tt><i>56</i> <span class="sd">            * name: EDAM</span></tt>
            </div>
            <div id="l57"
               class="code sev- "><tt><i>57</i> <span class="sd">            * schema: http://edamontology.org/EDAM.owl</span></tt>
            </div>
            <div id="l58"
               class="code sev- "><tt><i>58</i> &nbsp;</tt>
            </div>
            <div id="l59"
               class="code sev- "><tt><i>59</i> <span class="sd">    &quot;&quot;&quot;</span></tt>
            </div>
            <div id="l60"
               class="code sev- "><tt><i>60</i> &nbsp;</tt>
            </div>
            <div id="l61"
               class="code sev- "><tt><i>61</i>     <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_top_path</span><span class="p">,</span> <span class="n">output_ndx_path</span><span class="p">,</span> <span class="n">input_traj_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span></tt>
            </div>
            <div id="l62"
               class="code sev- "><tt><i>62</i>         <span class="n">properties</span> <span class="o">=</span> <span class="n">properties</span> <span class="ow">or</span> <span class="p">{}</span></tt>
            </div>
            <div id="l63"
               class="code sev- "><tt><i>63</i> &nbsp;</tt>
            </div>
            <div id="l64"
               class="code sev- "><tt><i>64</i>         <span class="c1"># Call parent class constructor</span></tt>
            </div>
            <div id="l65"
               class="code sev- "><tt><i>65</i>         <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span></tt>
            </div>
            <div id="l66"
               class="code sev- "><tt><i>66</i>         <span class="bp">self</span><span class="o">.</span><span class="n">locals_var_dict</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></tt>
            </div>
            <div id="l67"
               class="code sev- "><tt><i>67</i> &nbsp;</tt>
            </div>
            <div id="l68"
               class="code sev- "><tt><i>68</i>         <span class="c1"># Input/Output files</span></tt>
            </div>
            <div id="l69"
               class="code sev- "><tt><i>69</i>         <span class="bp">self</span><span class="o">.</span><span class="n">io_dict</span> <span class="o">=</span> <span class="p">{</span></tt>
            </div>
            <div id="l70"
               class="code sev- "><tt><i>70</i>             <span class="s2">&quot;in&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;input_top_path&quot;</span><span class="p">:</span> <span class="n">input_top_path</span><span class="p">,</span></tt>
            </div>
            <div id="l71"
               class="code sev- "><tt><i>71</i>                    <span class="s2">&quot;input_traj_path&quot;</span><span class="p">:</span> <span class="n">input_traj_path</span><span class="p">},</span></tt>
            </div>
            <div id="l72"
               class="code sev- "><tt><i>72</i>             <span class="s2">&quot;out&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;output_ndx_path&quot;</span><span class="p">:</span> <span class="n">output_ndx_path</span><span class="p">}</span></tt>
            </div>
            <div id="l73"
               class="code sev- "><tt><i>73</i>         <span class="p">}</span></tt>
            </div>
            <div id="l74"
               class="code sev- "><tt><i>74</i> &nbsp;</tt>
            </div>
            <div id="l75"
               class="code sev- "><tt><i>75</i>         <span class="c1"># Properties specific for BB</span></tt>
            </div>
            <div id="l76"
               class="code sev- "><tt><i>76</i>         <span class="bp">self</span><span class="o">.</span><span class="n">selection</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;selection&#39;</span><span class="p">,</span> <span class="s2">&quot;resname DPPC or resname POPC) and element P&quot;</span><span class="p">)</span></tt>
            </div>
            <div id="l77"
               class="code sev- "><tt><i>77</i>         <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cutoff&#39;</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">)</span></tt>
            </div>
            <div id="l78"
               class="code sev- "><tt><i>78</i>         <span class="bp">self</span><span class="o">.</span><span class="n">begin_frame</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;begin_frame&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span></tt>
            </div>
            <div id="l79"
               class="code sev- "><tt><i>79</i>         <span class="bp">self</span><span class="o">.</span><span class="n">end_frame</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;end_frame&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span></tt>
            </div>
            <div id="l80"
               class="code sev- "><tt><i>80</i>         <span class="bp">self</span><span class="o">.</span><span class="n">ignore_no_box</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ignore_no_box&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span></tt>
            </div>
            <div id="l81"
               class="code sev- "><tt><i>81</i>         <span class="bp">self</span><span class="o">.</span><span class="n">return_hydrogen</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;return_hydrogen&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span></tt>
            </div>
            <div id="l82"
               class="code sev- "><tt><i>82</i>         <span class="bp">self</span><span class="o">.</span><span class="n">binary_path</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;binary_path&#39;</span><span class="p">,</span> <span class="s1">&#39;fatslim&#39;</span><span class="p">)</span></tt>
            </div>
            <div id="l83"
               class="code sev- "><tt><i>83</i>         <span class="bp">self</span><span class="o">.</span><span class="n">properties</span> <span class="o">=</span> <span class="n">properties</span></tt>
            </div>
            <div id="l84"
               class="code sev- "><tt><i>84</i> &nbsp;</tt>
            </div>
            <div id="l85"
               class="code sev- "><tt><i>85</i>         <span class="c1"># Check the properties</span></tt>
            </div>
            <div id="l86"
               class="code sev- "><tt><i>86</i>         <span class="bp">self</span><span class="o">.</span><span class="n">check_properties</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span></tt>
            </div>
            <div id="l87"
               class="code sev- "><tt><i>87</i>         <span class="bp">self</span><span class="o">.</span><span class="n">check_arguments</span><span class="p">()</span></tt>
            </div>
            <div id="l88"
               class="code sev- "><tt><i>88</i> &nbsp;</tt>
            </div>
            <div id="l89"
               class="code sev- "><tt><i>89</i>     <span class="nd">@launchlogger</span></tt>
            </div>
            <div id="l90"
               class="code sev- "><tt><i>90</i>     <span class="k">def</span><span class="w"> </span><span class="nf">launch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span></tt>
            </div>
            <div id="l91"
               class="code sev- "><tt><i>91</i> <span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute the :class:`FatslimMembranes &lt;fatslim.fatslim_membranes.FatslimMembranes&gt;` fatslim.fatslim_membranes.FatslimMembranes object.&quot;&quot;&quot;</span></tt>
            </div>
            <div id="l92"
               class="code sev- "><tt><i>92</i> &nbsp;</tt>
            </div>
            <div id="l93"
               class="code sev- "><tt><i>93</i>         <span class="c1"># Setup Biobb</span></tt>
            </div>
            <div id="l94"
               class="code sev- "><tt><i>94</i>         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_restart</span><span class="p">():</span></tt>
            </div>
            <div id="l95"
               class="code sev- "><tt><i>95</i>             <span class="k">return</span> <span class="mi">0</span></tt>
            </div>
            <div id="l96"
               class="code sev- "><tt><i>96</i>         <span class="bp">self</span><span class="o">.</span><span class="n">stage_files</span><span class="p">()</span></tt>
            </div>
            <div id="l97"
               class="code sev- "><tt><i>97</i> &nbsp;</tt>
            </div>
            <div id="l98"
               class="code sev- "><tt><i>98</i>         <span class="c1"># Create index file using MDAnalysis</span></tt>
            </div>
            <div id="l99"
               class="code sev- "><tt><i>99</i>         <span class="n">u</span> <span class="o">=</span> <span class="n">mda</span><span class="o">.</span><span class="n">Universe</span><span class="p">(</span><span class="n">topology</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stage_io_dict</span><span class="p">[</span><span class="s2">&quot;in&quot;</span><span class="p">][</span><span class="s2">&quot;input_top_path&quot;</span><span class="p">],</span></tt>
            </div>
            <div id="l100"
               class="code sev- "><tt><i>100</i>                          <span class="n">coordinates</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stage_io_dict</span><span class="p">[</span><span class="s2">&quot;in&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;input_traj_path&quot;</span><span class="p">))</span></tt>
            </div>
            <div id="l101"
               class="code sev- "><tt><i>101</i>         <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">dimensions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span></tt>
            </div>
            <div id="l102"
               class="code sev- "><tt><i>102</i>             <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore_no_box</span><span class="p">:</span></tt>
            </div>
            <div id="l103"
               class="code sev- "><tt><i>103</i>                 <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: trajectory probably has no box variable. Setting dimensions ussing the minimum and maximum positions of the atoms.&#39;</span><span class="p">)</span></tt>
            </div>
            <div id="l104"
               class="code sev- "><tt><i>104</i>                 <span class="c1"># Calculate the dimensions of the box</span></tt>
            </div>
            <div id="l105"
               class="code sev- "><tt><i>105</i>                 <span class="n">positions</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">positions</span></tt>
            </div>
            <div id="l106"
               class="code sev- "><tt><i>106</i>                 <span class="n">box_dimensions</span> <span class="o">=</span> <span class="n">positions</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">positions</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></tt>
            </div>
            <div id="l107"
               class="code sev- "><tt><i>107</i>                 <span class="n">u</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">add_transformations</span><span class="p">(</span><span class="n">set_dimensions</span><span class="p">([</span><span class="o">*</span><span class="n">box_dimensions</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">]))</span></tt>
            </div>
            <div id="l108"
               class="code sev- "><tt><i>108</i>             <span class="k">else</span><span class="p">:</span></tt>
            </div>
            <div id="l109"
               class="code sev- "><tt><i>109</i>                 <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The trajectory does not contain box information. Please set the ignore_no_box property to True to ignore this error.&#39;</span><span class="p">)</span></tt>
            </div>
            <div id="l110"
               class="code sev- "><tt><i>110</i> &nbsp;</tt>
            </div>
            <div id="l111"
               class="code sev- "><tt><i>111</i>         <span class="c1"># Build the index to select the atoms from the membrane</span></tt>
            </div>
            <div id="l112"
               class="code sev- "><tt><i>112</i>         <span class="bp">self</span><span class="o">.</span><span class="n">tmp_ndx</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">PurePath</span><span class="p">(</span><span class="n">fu</span><span class="o">.</span><span class="n">create_unique_dir</span><span class="p">())</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;headgroups.ndx&#39;</span><span class="p">))</span></tt>
            </div>
            <div id="l113"
               class="code sev- "><tt><i>113</i>         <span class="k">with</span> <span class="n">mda</span><span class="o">.</span><span class="n">selections</span><span class="o">.</span><span class="n">gromacs</span><span class="o">.</span><span class="n">SelectionWriter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_ndx</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ndx</span><span class="p">:</span></tt>
            </div>
            <div id="l114"
               class="code sev- "><tt><i>114</i>             <span class="n">ndx</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">select_atoms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selection</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;headgroups&#39;</span><span class="p">)</span></tt>
            </div>
            <div id="l115"
               class="code sev- "><tt><i>115</i> &nbsp;</tt>
            </div>
            <div id="l116"
               class="code sev- "><tt><i>116</i>         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage_io_dict</span><span class="p">[</span><span class="s2">&quot;in&quot;</span><span class="p">][</span><span class="s2">&quot;input_top_path&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;gro&#39;</span><span class="p">):</span></tt>
            </div>
            <div id="l117"
               class="code sev- "><tt><i>117</i>             <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage_io_dict</span><span class="p">[</span><span class="s2">&quot;in&quot;</span><span class="p">][</span><span class="s2">&quot;input_top_path&quot;</span><span class="p">]</span></tt>
            </div>
            <div id="l118"
               class="code sev- "><tt><i>118</i>             <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span> <span class="o">=</span> <span class="p">[]</span></tt>
            </div>
            <div id="l119"
               class="code sev- "><tt><i>119</i>         <span class="k">else</span><span class="p">:</span></tt>
            </div>
            <div id="l120"
               class="code sev- "><tt><i>120</i>             <span class="c1"># Convert topology .gro and add box dimensions if not available in the topology</span></tt>
            </div>
            <div id="l121"
               class="code sev- "><tt><i>121</i>             <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">PurePath</span><span class="p">(</span><span class="n">fu</span><span class="o">.</span><span class="n">create_unique_dir</span><span class="p">())</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;output.gro&#39;</span><span class="p">))</span></tt>
            </div>
            <div id="l122"
               class="code sev- "><tt><i>122</i>             <span class="bp">self</span><span class="o">.</span><span class="n">tmp_files</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">PurePath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">])</span></tt>
            </div>
            <div id="l123"
               class="code sev- "><tt><i>123</i>             <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gmx&#39;</span><span class="p">,</span> <span class="s1">&#39;editconf&#39;</span><span class="p">,</span></tt>
            </div>
            <div id="l124"
               class="code sev- "><tt><i>124</i>                         <span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage_io_dict</span><span class="p">[</span><span class="s2">&quot;in&quot;</span><span class="p">][</span><span class="s2">&quot;input_top_path&quot;</span><span class="p">],</span></tt>
            </div>
            <div id="l125"
               class="code sev- "><tt><i>125</i>                         <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span></tt>
            </div>
            <div id="l126"
               class="code sev- "><tt><i>126</i>                         <span class="s1">&#39;-box&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[:</span><span class="mi">3</span><span class="p">])),</span> <span class="s1">&#39;;&#39;</span><span class="p">,</span></tt>
            </div>
            <div id="l127"
               class="code sev- "><tt><i>127</i>                         <span class="p">]</span></tt>
            </div>
            <div id="l128"
               class="code sev- "><tt><i>128</i>         <span class="bp">self</span><span class="o">.</span><span class="n">tmp_out</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">PurePath</span><span class="p">(</span><span class="n">fu</span><span class="o">.</span><span class="n">create_unique_dir</span><span class="p">())</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;output.ndx&#39;</span><span class="p">))</span></tt>
            </div>
            <div id="l129"
               class="code sev- "><tt><i>129</i> &nbsp;</tt>
            </div>
            <div id="l130"
               class="code sev- "><tt><i>130</i>         <span class="c1"># Build command</span></tt>
            </div>
            <div id="l131"
               class="code sev- "><tt><i>131</i>         <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span></tt>
            </div>
            <div id="l132"
               class="code sev- "><tt><i>132</i>             <span class="bp">self</span><span class="o">.</span><span class="n">binary_path</span><span class="p">,</span> <span class="s2">&quot;membranes&quot;</span><span class="p">,</span></tt>
            </div>
            <div id="l133"
               class="code sev- "><tt><i>133</i>             <span class="s2">&quot;-n&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_ndx</span><span class="p">,</span></tt>
            </div>
            <div id="l134"
               class="code sev- "><tt><i>134</i>             <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">,</span></tt>
            </div>
            <div id="l135"
               class="code sev- "><tt><i>135</i>             <span class="s2">&quot;--output-index&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_out</span><span class="p">,</span></tt>
            </div>
            <div id="l136"
               class="code sev- "><tt><i>136</i>             <span class="s2">&quot;--cutoff&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span><span class="p">),</span></tt>
            </div>
            <div id="l137"
               class="code sev- "><tt><i>137</i>             <span class="s2">&quot;--begin-frame&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">begin_frame</span><span class="p">),</span></tt>
            </div>
            <div id="l138"
               class="code sev- "><tt><i>138</i>             <span class="s2">&quot;--end-frame&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_frame</span><span class="p">)</span></tt>
            </div>
            <div id="l139"
               class="code sev- "><tt><i>139</i>         <span class="p">])</span></tt>
            </div>
            <div id="l140"
               class="code sev- "><tt><i>140</i> &nbsp;</tt>
            </div>
            <div id="l141"
               class="code sev- "><tt><i>141</i>         <span class="c1"># Run Biobb block</span></tt>
            </div>
            <div id="l142"
               class="code sev- "><tt><i>142</i>         <span class="bp">self</span><span class="o">.</span><span class="n">run_biobb</span><span class="p">()</span></tt>
            </div>
            <div id="l143"
               class="code sev- "><tt><i>143</i>         <span class="c1"># Fatslim ignore H atoms so we add them manually</span></tt>
            </div>
            <div id="l144"
               class="code sev- "><tt><i>144</i>         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_hydrogen</span><span class="p">:</span></tt>
            </div>
            <div id="l145"
               class="code sev- "><tt><i>145</i>             <span class="c1"># Parse the atoms indices of the membrane without Hs</span></tt>
            </div>
            <div id="l146"
               class="code sev- "><tt><i>146</i>             <span class="n">leaflet_groups</span> <span class="o">=</span> <span class="n">parse_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_out</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_0000.ndx&#39;</span><span class="p">)</span></tt>
            </div>
            <div id="l147"
               class="code sev- "><tt><i>147</i>             <span class="k">with</span> <span class="n">mda</span><span class="o">.</span><span class="n">selections</span><span class="o">.</span><span class="n">gromacs</span><span class="o">.</span><span class="n">SelectionWriter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stage_io_dict</span><span class="p">[</span><span class="s2">&quot;out&quot;</span><span class="p">][</span><span class="s2">&quot;output_ndx_path&quot;</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ndx</span><span class="p">:</span></tt>
            </div>
            <div id="l148"
               class="code sev- "><tt><i>148</i>                 <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">leaflet_groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span></tt>
            </div>
            <div id="l149"
               class="code sev- "><tt><i>149</i>                     <span class="c1"># Select the residues using atom indexes</span></tt>
            </div>
            <div id="l150"
               class="code sev- "><tt><i>150</i>                     <span class="n">res_sele</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">residues</span><span class="o">.</span><span class="n">resindices</span><span class="p">)</span></tt>
            </div>
            <div id="l151"
               class="code sev- "><tt><i>151</i>                     <span class="c1"># Use the rexindex to select all the atoms of the residue</span></tt>
            </div>
            <div id="l152"
               class="code sev- "><tt><i>152</i>                     <span class="n">sele</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;resindex </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">res_sele</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span></tt>
            </div>
            <div id="l153"
               class="code sev- "><tt><i>153</i>                     <span class="n">ndx</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">select_atoms</span><span class="p">(</span><span class="n">sele</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="n">key</span><span class="p">)</span></tt>
            </div>
            <div id="l154"
               class="code sev- "><tt><i>154</i>         <span class="k">else</span><span class="p">:</span></tt>
            </div>
            <div id="l155"
               class="code sev- "><tt><i>155</i>             <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_out</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_0000.ndx&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stage_io_dict</span><span class="p">[</span><span class="s2">&quot;out&quot;</span><span class="p">][</span><span class="s2">&quot;output_ndx_path&quot;</span><span class="p">])</span></tt>
            </div>
            <div id="l156"
               class="code sev- "><tt><i>156</i>         <span class="c1"># Copy files to host</span></tt>
            </div>
            <div id="l157"
               class="code sev- "><tt><i>157</i>         <span class="bp">self</span><span class="o">.</span><span class="n">copy_to_host</span><span class="p">()</span></tt>
            </div>
            <div id="l158"
               class="code sev- "><tt><i>158</i> &nbsp;</tt>
            </div>
            <div id="l159"
               class="code sev- "><tt><i>159</i>         <span class="c1"># Remove temporary files</span></tt>
            </div>
            <div id="l160"
               class="code sev- "><tt><i>160</i>         <span class="bp">self</span><span class="o">.</span><span class="n">tmp_files</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span></tt>
            </div>
            <div id="l161"
               class="code sev- "><tt><i>161</i>             <span class="bp">self</span><span class="o">.</span><span class="n">stage_io_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;unique_dir&quot;</span><span class="p">),</span></tt>
            </div>
            <div id="l162"
               class="code sev- "><tt><i>162</i>             <span class="n">PurePath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_ndx</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span></tt>
            </div>
            <div id="l163"
               class="code sev- "><tt><i>163</i>             <span class="n">PurePath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_out</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span></tt>
            </div>
            <div id="l164"
               class="code sev- "><tt><i>164</i>         <span class="p">])</span></tt>
            </div>
            <div id="l165"
               class="code sev- "><tt><i>165</i>         <span class="bp">self</span><span class="o">.</span><span class="n">remove_tmp_files</span><span class="p">()</span></tt>
            </div>
            <div id="l166"
               class="code sev- "><tt><i>166</i> &nbsp;</tt>
            </div>
            <div id="l167"
               class="code sev- "><tt><i>167</i>         <span class="bp">self</span><span class="o">.</span><span class="n">check_arguments</span><span class="p">(</span><span class="n">output_files_created</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">raise_exception</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></tt>
            </div>
            <div id="l168"
               class="code sev- "><tt><i>168</i> &nbsp;</tt>
            </div>
            <div id="l169"
               class="code sev- "><tt><i>169</i>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_code</span></tt>
            </div>
            <div id="l170"
               class="code sev- "><tt><i>170</i> &nbsp;</tt>
            </div>
            <div id="l171"
               class="code sev- "><tt><i>171</i> &nbsp;</tt>
            </div>
            <div id="l172"
               class="code sev- "><tt><i>172</i> <span class="k">def</span><span class="w"> </span><span class="nf">fatslim_membranes</span><span class="p">(</span><span class="n">input_top_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output_ndx_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">input_traj_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span></tt>
            </div>
            <div id="l173"
               class="code sev- "><tt><i>173</i> <span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute the :class:`FatslimMembranes &lt;fatslim.fatslim_membranes.FatslimMembranes&gt;` class and</span></tt>
            </div>
            <div id="l174"
               class="code sev- "><tt><i>174</i> <span class="sd">    execute the :meth:`launch() &lt;fatslim.fatslim_membranes.FatslimMembranes.launch&gt;` method.&quot;&quot;&quot;</span></tt>
            </div>
            <div id="l175"
               class="code sev- "><tt><i>175</i> &nbsp;</tt>
            </div>
            <div id="l176"
               class="code sev- "><tt><i>176</i>     <span class="k">return</span> <span class="n">FatslimMembranes</span><span class="p">(</span><span class="n">input_top_path</span><span class="o">=</span><span class="n">input_top_path</span><span class="p">,</span></tt>
            </div>
            <div id="l177"
               class="code sev- "><tt><i>177</i>                             <span class="n">input_traj_path</span><span class="o">=</span><span class="n">input_traj_path</span><span class="p">,</span></tt>
            </div>
            <div id="l178"
               class="code sev- "><tt><i>178</i>                             <span class="n">output_ndx_path</span><span class="o">=</span><span class="n">output_ndx_path</span><span class="p">,</span></tt>
            </div>
            <div id="l179"
               class="code sev- "><tt><i>179</i>                             <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">launch</span><span class="p">()</span></tt>
            </div>
            <div id="l180"
               class="code sev- "><tt><i>180</i> &nbsp;</tt>
            </div>
            <div id="l181"
               class="code sev- "><tt><i>181</i> &nbsp;</tt>
            </div>
            <div id="l182"
               class="code sev- "><tt><i>182</i> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span></tt>
            </div>
            <div id="l183"
               class="code sev- "><tt><i>183</i> <span class="w">    </span><span class="sd">&quot;&quot;&quot;Command line execution of this building block. Please check the command line documentation.&quot;&quot;&quot;</span></tt>
            </div>
            <div id="l184"
               class="code sev- "><tt><i>184</i>     <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Calculates the density along an axis of a given cpptraj compatible trajectory.&quot;</span><span class="p">,</span> <span class="n">formatter_class</span><span class="o">=</span><span class="k">lambda</span> <span class="n">prog</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">RawTextHelpFormatter</span><span class="p">(</span><span class="n">prog</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">99999</span><span class="p">))</span></tt>
            </div>
            <div id="l185"
               class="code sev- "><tt><i>185</i>     <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--config&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Configuration file&#39;</span><span class="p">)</span></tt>
            </div>
            <div id="l186"
               class="code sev- "><tt><i>186</i> &nbsp;</tt>
            </div>
            <div id="l187"
               class="code sev- "><tt><i>187</i>     <span class="c1"># Specific args of each building block</span></tt>
            </div>
            <div id="l188"
               class="code sev- "><tt><i>188</i>     <span class="n">required_args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="s1">&#39;required arguments&#39;</span><span class="p">)</span></tt>
            </div>
            <div id="l189"
               class="code sev- "><tt><i>189</i>     <span class="n">required_args</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--input_top_path&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Path to the input structure or topology file. Accepted formats: ent, gro, pdb, tpr.&#39;</span><span class="p">)</span></tt>
            </div>
            <div id="l190"
               class="code sev- "><tt><i>190</i>     <span class="n">required_args</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--output_ndx_path&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Path to the GROMACS index file. Accepted formats: ndx&#39;</span><span class="p">)</span></tt>
            </div>
            <div id="l191"
               class="code sev- "><tt><i>191</i>     <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--input_traj_path&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Path to the input trajectory to be processed. Accepted formats: gro, pdb, tng, trr, xtc.&#39;</span><span class="p">)</span></tt>
            </div>
            <div id="l192"
               class="code sev- "><tt><i>192</i> &nbsp;</tt>
            </div>
            <div id="l193"
               class="code sev- "><tt><i>193</i>     <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span></tt>
            </div>
            <div id="l194"
               class="code sev- "><tt><i>194</i>     <span class="n">args</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">config</span> <span class="ow">or</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span></tt>
            </div>
            <div id="l195"
               class="code sev- "><tt><i>195</i>     <span class="n">properties</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">ConfReader</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">config</span><span class="p">)</span><span class="o">.</span><span class="n">get_prop_dic</span><span class="p">()</span></tt>
            </div>
            <div id="l196"
               class="code sev- "><tt><i>196</i> &nbsp;</tt>
            </div>
            <div id="l197"
               class="code sev- "><tt><i>197</i>     <span class="c1"># Specific call of each building block</span></tt>
            </div>
            <div id="l198"
               class="code sev- "><tt><i>198</i>     <span class="n">fatslim_membranes</span><span class="p">(</span><span class="n">input_top_path</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">input_top_path</span><span class="p">,</span></tt>
            </div>
            <div id="l199"
               class="code sev- "><tt><i>199</i>                       <span class="n">output_ndx_path</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">output_ndx_path</span><span class="p">,</span></tt>
            </div>
            <div id="l200"
               class="code sev- "><tt><i>200</i>                       <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">)</span></tt>
            </div>
            <div id="l201"
               class="code sev- "><tt><i>201</i> &nbsp;</tt>
            </div>
            <div id="l202"
               class="code sev- "><tt><i>202</i> &nbsp;</tt>
            </div>
            <div id="l203"
               class="code sev- "><tt><i>203</i> <span class="k">def</span><span class="w"> </span><span class="nf">parse_index</span><span class="p">(</span><span class="n">ndx</span><span class="p">):</span></tt>
            </div>
            <div id="l204"
               class="code sev- "><tt><i>204</i> <span class="w">    </span><span class="sd">&quot;&quot;&quot;</span></tt>
            </div>
            <div id="l205"
               class="code sev- "><tt><i>205</i> <span class="sd">    Parses a GROMACS index file (.ndx) to extract leaflet groups.</span></tt>
            </div>
            <div id="l206"
               class="code sev- "><tt><i>206</i> &nbsp;</tt>
            </div>
            <div id="l207"
               class="code sev- "><tt><i>207</i> <span class="sd">    Args:</span></tt>
            </div>
            <div id="l208"
               class="code sev- "><tt><i>208</i> <span class="sd">        ndx (str): Path to the GROMACS index file (.ndx).</span></tt>
            </div>
            <div id="l209"
               class="code sev- "><tt><i>209</i> <span class="sd">    Returns:</span></tt>
            </div>
            <div id="l210"
               class="code sev- "><tt><i>210</i> <span class="sd">        dict: A dictionary where keys are group names for each leaflet in format &quot;membrane_1_leaflet_1&quot; and values are lists of integers representing atom indices.</span></tt>
            </div>
            <div id="l211"
               class="code sev- "><tt><i>211</i> <span class="sd">    &quot;&quot;&quot;</span></tt>
            </div>
            <div id="l212"
               class="code sev- "><tt><i>212</i> &nbsp;</tt>
            </div>
            <div id="l213"
               class="code sev- "><tt><i>213</i>     <span class="c1"># Read the leaflet.ndx file</span></tt>
            </div>
            <div id="l214"
               class="code sev- "><tt><i>214</i>     <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ndx</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span></tt>
            </div>
            <div id="l215"
               class="code sev- "><tt><i>215</i>         <span class="n">leaflet_data</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span></tt>
            </div>
            <div id="l216"
               class="code sev- "><tt><i>216</i> &nbsp;</tt>
            </div>
            <div id="l217"
               class="code sev- "><tt><i>217</i>     <span class="c1"># Initialize dictionaries to store leaflet groups</span></tt>
            </div>
            <div id="l218"
               class="code sev- "><tt><i>218</i>     <span class="n">leaflet_groups</span> <span class="o">=</span> <span class="p">{}</span></tt>
            </div>
            <div id="l219"
               class="code sev- "><tt><i>219</i>     <span class="n">current_group</span> <span class="o">=</span> <span class="kc">None</span></tt>
            </div>
            <div id="l220"
               class="code sev- "><tt><i>220</i> &nbsp;</tt>
            </div>
            <div id="l221"
               class="code sev- "><tt><i>221</i>     <span class="c1"># Parse the leaflet.ndx file</span></tt>
            </div>
            <div id="l222"
               class="code sev- "><tt><i>222</i>     <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">leaflet_data</span><span class="p">:</span></tt>
            </div>
            <div id="l223"
               class="code sev- "><tt><i>223</i>         <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span></tt>
            </div>
            <div id="l224"
               class="code sev- "><tt><i>224</i>         <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">):</span></tt>
            </div>
            <div id="l225"
               class="code sev- "><tt><i>225</i>             <span class="n">current_group</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span></tt>
            </div>
            <div id="l226"
               class="code sev- "><tt><i>226</i>             <span class="n">leaflet_groups</span><span class="p">[</span><span class="n">current_group</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></tt>
            </div>
            <div id="l227"
               class="code sev- "><tt><i>227</i>         <span class="k">elif</span> <span class="n">current_group</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span></tt>
            </div>
            <div id="l228"
               class="code sev- "><tt><i>228</i>             <span class="n">leaflet_groups</span><span class="p">[</span><span class="n">current_group</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()))</span></tt>
            </div>
            <div id="l229"
               class="code sev- "><tt><i>229</i>     <span class="k">return</span> <span class="n">leaflet_groups</span></tt>
            </div>
            <div id="l230"
               class="code sev- "><tt><i>230</i> &nbsp;</tt>
            </div>
            <div id="l231"
               class="code sev- "><tt><i>231</i> &nbsp;</tt>
            </div>
            <div id="l232"
               class="code sev- "><tt><i>232</i> <span class="k">def</span><span class="w"> </span><span class="nf">display_fatslim</span><span class="p">(</span><span class="n">input_top_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">lipid_sel</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">input_traj_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">output_ndx_path</span><span class="o">=</span><span class="s2">&quot;leaflets.ndx&quot;</span><span class="p">,</span> <span class="n">leaflets</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span></tt>
            </div>
            <div id="l233"
               class="code sev- "><tt><i>233</i>                     <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;cyan&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="s1">&#39;magenta&#39;</span><span class="p">],</span> <span class="n">non_mem_color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">):</span></tt>
            </div>
            <div id="l234"
               class="code sev- "><tt><i>234</i> <span class="w">    </span><span class="sd">&quot;&quot;&quot;</span></tt>
            </div>
            <div id="l235"
               class="code sev- "><tt><i>235</i> <span class="sd">    Visualize the leaflets of a membrane using NGLView. The lipids in the membrane are colored according to their leaflet. The ones not in the membrane are colored in red.</span></tt>
            </div>
            <div id="l236"
               class="code sev- "><tt><i>236</i> &nbsp;</tt>
            </div>
            <div id="l237"
               class="code sev- "><tt><i>237</i> <span class="sd">    Args:</span></tt>
            </div>
            <div id="l238"
               class="code sev- "><tt><i>238</i> <span class="sd">        input_top_path (str): Path to the input topology file.</span></tt>
            </div>
            <div id="l239"
               class="code sev- "><tt><i>239</i> <span class="sd">        input_traj_path (str, optional): Path to the input trajectory file. Default is None.</span></tt>
            </div>
            <div id="l240"
               class="code sev- "><tt><i>240</i> <span class="sd">        output_ndx_path (str, optional): Path to the output index file containing leaflet information. Default is &quot;leaflets.ndx&quot;.</span></tt>
            </div>
            <div id="l241"
               class="code sev- "><tt><i>241</i> <span class="sd">        leaflets (bool, optional): If True, visualize individual leaflets. If False, visualize entire membranes. Default is True.</span></tt>
            </div>
            <div id="l242"
               class="code sev- "><tt><i>242</i> <span class="sd">        colors (list of str, optional): List of colors to use for visualizing the leaflets or membranes. Default is [&#39;blue&#39;, &#39;cyan&#39;, &#39;yellow&#39;, &#39;orange&#39;, &#39;purple&#39;, &#39;magenta&#39;].</span></tt>
            </div>
            <div id="l243"
               class="code sev- "><tt><i>243</i> <span class="sd">        non_mem_color (str, optional): Color to use for visualizing lipids not in the membrane. Default is &#39;red&#39;.</span></tt>
            </div>
            <div id="l244"
               class="code sev- "><tt><i>244</i> <span class="sd">    Returns:</span></tt>
            </div>
            <div id="l245"
               class="code sev- "><tt><i>245</i> <span class="sd">        nglview.NGLWidget: An NGLView widget displaying the membrane leaflets.</span></tt>
            </div>
            <div id="l246"
               class="code sev- "><tt><i>246</i> <span class="sd">    &quot;&quot;&quot;</span></tt>
            </div>
            <div id="l247"
               class="code sev- "><tt><i>247</i>     <span class="k">try</span><span class="p">:</span></tt>
            </div>
            <div id="l248"
               class="code sev- "><tt><i>248</i>         <span class="kn">import</span><span class="w"> </span><span class="nn">nglview</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nv</span></tt>
            </div>
            <div id="l249"
               class="code sev- "><tt><i>249</i>     <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span></tt>
            </div>
            <div id="l250"
               class="code sev- "><tt><i>250</i>         <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s1">&#39;Please install the nglview package to visualize the membrane/s.&#39;</span><span class="p">)</span></tt>
            </div>
            <div id="l251"
               class="code sev- "><tt><i>251</i> &nbsp;</tt>
            </div>
            <div id="l252"
               class="code sev- "><tt><i>252</i>     <span class="n">u</span> <span class="o">=</span> <span class="n">mda</span><span class="o">.</span><span class="n">Universe</span><span class="p">(</span><span class="n">topology</span><span class="o">=</span><span class="n">input_top_path</span><span class="p">,</span></tt>
            </div>
            <div id="l253"
               class="code sev- "><tt><i>253</i>                      <span class="n">coordinates</span><span class="o">=</span><span class="n">input_traj_path</span><span class="p">)</span></tt>
            </div>
            <div id="l254"
               class="code sev- "><tt><i>254</i>     <span class="c1"># Visualize the system with NGLView</span></tt>
            </div>
            <div id="l255"
               class="code sev- "><tt><i>255</i>     <span class="n">view</span> <span class="o">=</span> <span class="n">nv</span><span class="o">.</span><span class="n">show_mdanalysis</span><span class="p">(</span><span class="n">u</span><span class="p">)</span></tt>
            </div>
            <div id="l256"
               class="code sev- "><tt><i>256</i>     <span class="n">view</span><span class="o">.</span><span class="n">clear_representations</span><span class="p">()</span></tt>
            </div>
            <div id="l257"
               class="code sev- "><tt><i>257</i> &nbsp;</tt>
            </div>
            <div id="l258"
               class="code sev- "><tt><i>258</i>     <span class="n">leaflet_groups</span> <span class="o">=</span> <span class="n">parse_index</span><span class="p">(</span><span class="n">output_ndx_path</span><span class="p">)</span></tt>
            </div>
            <div id="l259"
               class="code sev- "><tt><i>259</i>     <span class="n">n_mems</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">leaflet_groups</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">//</span><span class="mi">2</span></tt>
            </div>
            <div id="l260"
               class="code sev- "><tt><i>260</i> &nbsp;</tt>
            </div>
            <div id="l261"
               class="code sev- "><tt><i>261</i>     <span class="n">non_mem_resn</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">select_atoms</span><span class="p">(</span><span class="n">lipid_sel</span><span class="p">)</span><span class="o">.</span><span class="n">residues</span><span class="o">.</span><span class="n">resnums</span><span class="p">)</span></tt>
            </div>
            <div id="l262"
               class="code sev- "><tt><i>262</i>     <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_mems</span><span class="p">):</span></tt>
            </div>
            <div id="l263"
               class="code sev- "><tt><i>263</i>         <span class="c1"># Convert atoms list to resnums (nglview uses cannot use resindex)</span></tt>
            </div>
            <div id="l264"
               class="code sev- "><tt><i>264</i>         <span class="n">top_resn</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">leaflet_groups</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;membrane_</span><span class="si">{</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">_leaflet_1&#39;</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">residues</span><span class="o">.</span><span class="n">resnums</span></tt>
            </div>
            <div id="l265"
               class="code sev- "><tt><i>265</i>         <span class="n">bot_resn</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">leaflet_groups</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;membrane_</span><span class="si">{</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">_leaflet_2&#39;</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">residues</span><span class="o">.</span><span class="n">resnums</span></tt>
            </div>
            <div id="l266"
               class="code sev- "><tt><i>266</i>         <span class="n">non_mem_resn</span> <span class="o">-=</span> <span class="nb">set</span><span class="p">(</span><span class="n">top_resn</span><span class="p">)</span></tt>
            </div>
            <div id="l267"
               class="code sev- "><tt><i>267</i>         <span class="n">non_mem_resn</span> <span class="o">-=</span> <span class="nb">set</span><span class="p">(</span><span class="n">bot_resn</span><span class="p">)</span></tt>
            </div>
            <div id="l268"
               class="code sev- "><tt><i>268</i>         <span class="k">if</span> <span class="n">leaflets</span><span class="p">:</span></tt>
            </div>
            <div id="l269"
               class="code sev- "><tt><i>269</i>             <span class="n">view</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">selection</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">top_resn</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">n</span><span class="o">*</span><span class="mi">2</span><span class="p">])</span>     <span class="c1"># lipids in top leaflet</span></tt>
            </div>
            <div id="l270"
               class="code sev- "><tt><i>270</i>             <span class="n">view</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">selection</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">bot_resn</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">n</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>   <span class="c1"># lipids in bot leaflet</span></tt>
            </div>
            <div id="l271"
               class="code sev- "><tt><i>271</i>         <span class="k">else</span><span class="p">:</span></tt>
            </div>
            <div id="l272"
               class="code sev- "><tt><i>272</i>             <span class="n">mem_resn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">top_resn</span><span class="p">,</span> <span class="n">bot_resn</span><span class="p">))</span></tt>
            </div>
            <div id="l273"
               class="code sev- "><tt><i>273</i>             <span class="n">view</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">selection</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">mem_resn</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">n</span><span class="o">*</span><span class="mi">2</span><span class="p">])</span>     <span class="c1"># lipids in membrane</span></tt>
            </div>
            <div id="l274"
               class="code sev- "><tt><i>274</i>     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">non_mem_resn</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span></tt>
            </div>
            <div id="l275"
               class="code sev- "><tt><i>275</i>         <span class="n">view</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">selection</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">non_mem_resn</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="n">non_mem_color</span><span class="p">)</span>   <span class="c1"># lipids without membrane</span></tt>
            </div>
            <div id="l276"
               class="code sev- "><tt><i>276</i>     <span class="k">return</span> <span class="n">view</span></tt>
            </div>
            <div id="l277"
               class="code sev- "><tt><i>277</i> &nbsp;</tt>
            </div>
            <div id="l278"
               class="code sev- "><tt><i>278</i> &nbsp;</tt>
            </div>
            <div id="l279"
               class="code sev- "><tt><i>279</i> <span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span></tt>
            </div>
            <div id="l280"
               class="code sev- "><tt><i>280</i>     <span class="n">main</span><span class="p">()</span></tt>
            </div>
            
         </div>
      </div>
   </body>
</html>